# 테스트를 왜 해야 하는가?

### 안정감과 자신감
테스트를 작성하지 않고, 혹은 부분적으로만 작성하고 서버를 구현하면  
배포 단계에서 두 손, 두 발 모으고 기도하고 있는 자신의 모습을 자주 볼 수 있다.  

또한 코드를 짜는 순간에도
 - 지금 짜고 있는 코드가 내 의도대로 돌아갈지
 - 내가 의도한 바가 올바른 것인지
 - 내가 생각하지 못한 예외가 있는지
 - 지금 사용하려는 라이브러리가 동작하는 방식이 이게 맞는지
등등 여러 의심이 쌓인다.

이런 의심들을 무시하고 코드를 짤 수록 불안감이 쌓이고 내 코드에 확신을 가지지 못하는 **살얼음판**위를 걷는 개발자가 될 것이다.  

빡빡한 테스트를 거치고 기능을 구현한다면  
오류가 터지는 횟수 자체도 효과적으로 줄일 뿐 아니라,  
어떤 오류가 터졌을 때, 테스트를 빡빡하게 한 특정 메서드는 아닐거라는 확신을 가질 수 있어 빠른 디버깅이 가능하다.  

코드를 짜면서 '이거 이렇게 해도 되나..?' 고민 시간의 비중이 꽤 크기 때문에  
테스트를 통해 이러한 시간을 확신을 가지게 하는 시간으로 바꾼다면  
오히려 빠른 개발이 가능할 것

### Regression Test

다른 팀원이나 어제의 나와 협업을 하다보면  
종종 잘 돌아가던 기능들이 새로 추가되거나 수정된 영역에 의해 갑자기 안되는 경우가 종종 있다.

Regression Test는 내가 어떤 기능을 추가/수정 했을 때, 기존 기능과의 충돌이 없는지를 테스트 하는 것이다.  
말만 들어도 굉장히 불편하고 오래 걸리는 작업이 될 것 같지만,  
Spring에는 JUnit이라는 강력한 테스트 프레임워크가 내장돼 있다.  

빡빡하게 짜면서 하나씩 쌓아올리는 incremental한 방식에서 지속적인 Regression Test,  
즉 이전에 짰던 모든 테스트들의 실행 한번 딸깍은  
성을 쌓는데 새로운 층을 얹기 전에 아랫층의 기반을 확인해보는 것과 같이 매우 중요한 작업이다.  

밑받침이 튼튼한 것 역시 개발작에게 **안정감과 자신감**을 주는게 아닐까  

### 문서 역할

잘 정의된 테스트 컨벤션은 보조 문서의 역할도 할 수 있다.
@DisplayName 등의 어노테이션을 활용한다면 내가 어떤 테스트를 짰고 덜 짰는지 매우 효과적으로 확인할 수 있을 것

# 어떻게 해야 하는가?

### 미루지 말것

개인적인 생각으로  
정상 흐름들과 예외 흐름들이 가장 잘 상상되는 시점은 구현하는 시점이다.

물론 정석대로라면  
User flow, 시퀀스 다이어그램, 시나리오 등등을 거치며 테스트 플랜 역시 작성하는 것이 맞겠지만,  
특정 라이브러리의 내부 동작 방식이라거나, 예외 처리 방식 등은 막상 사용하는 단계가 와야 실질적인 고민이 된다.  
안정감과 자신감을 위해서는 이러한 것들 역시 모두 테스트의 대상이다.(물론 완전히 익숙해지면 pass 해도 되겠지만)  

또 스터디를 운영하며 TDD를 해본 결과, 정상 흐름과 예외 흐름을 사전에 예상하는 것 역시 어느정도 경험의 도움이 필요하기 때문에  
사전에 최대한 정의를 하되,  
코드를 구현하며 생각나는 것들을 놓쳐서는 안된다.  

인간은 망각의 동물이기 때문에..  
'이거 다 하고 만들어야지' 하고 넘어갔다가 에러를 겪은 경험이 몇번 있다.  

최고의 방법은 생각나는 족족 문서에 작성 + 테스트 메서드 작성이라고 생각  
최소한 테스트 메서드 껍데기라도(인터페이스) 작성하는 것이 좋을 듯.

### 테스트 플랜 문서화

미루지 않고 바로바로 작성하는 건 망각 방지라고 한다면  
테스트 플랜은  
 - 테스트를 짜면서 '뭘 하려고 했는지' 라든가, '뭘 하고 있었지' 같이 길을 잃어버리지 않게 해주고
 - 빠트린 테스트가 없는지, 의도한 커버리지 수준까지 테스트를 잘 짰는지 검증하게끔
도와주는 용도이다.

이외에도 프로젝트를 후임자에게 물려주거나  
기능을 의도한대로 잘 구현했는지 확인하거나 등등  
사용처가 많으니 문서화가 귀찮더라도 꼭 작성할 것.

### 다다익선

skklub에서 작성한 테스트가 200개를 넘어갈 때 즈음부터 기능의 추가나 수정 요구가 하나 둘 생겼는데,  
문제는 테스트를 제외한 아키텍처를 최대한 변경 지점을 최소화 하고자 가져갔더라도  
너무 많은 테스트들 때문에 의존하는 지점이 많아진다는 것이었다.  

즉 테스트를 포함한 아키텍처를 본다면 테스트가 많아질 수록 전체적인 서버 아키텍처가 맛있는 스파게티가 되어 가고 있는게 아닐까 하는 의문이 생겼다.  

소프트웨어공학개론 테스트 내용을 다루는 주차에 교수님께 이러한 고민을 질문 드렸고
**시간과 비용**이 무한대로 허용된다고 가정한다면, 이런 상황에서는 테스트를 줄이는 것이 맞는지,  
아니면 감수하고 계속 많은 양의 테스트를 가져가는 것이 맞는지 여쭤봤다.  

돌아온 답변은  
만약 그 테스트들이 가능한 상황들을 불필요하지 않게 커버하고 있다면 어쩔 수 없다 였다.  
사전에 테스트 플랜을 well define하는게 매우 중요하다는 말씀도 추가로 해주셨다.  

안정감과 자신감을 위해 어느정도 포기해야 하는 영역인듯.

### first 원칙

# 테스트 주도 개발 방법론

유행따라 적용해보고자 노력중  
가장 체감되는 장점은 테스트 강제성인것 같다.  

```
Controller Layer interface 및 단위 테스트 작성 -> Service Layer interface 작성 -> Controller Layer Body 완성 및 단위 테스트 성공
-> Service Layer 단위 테스트 작성 -> Repository Layer interface 작성 -> Service Layer Body 완성 및 단위 테스트 성공
-> Repository Layer 단위 테스트 작성 -> Repository Layer Body 완성 및 단위 테스트 성공
-> API 통합 테스트 -> Postman 스크립트 작성 및 테스트 -> API 문서화
```

API 단위로 기능을 추가하는 방식을 선택했고  
각 Layer 별 흐름은
 1. 인터페이스 작성
 2. 테스트 작성
 3. 몸통 구현
 4. 테스트 성공
이다. 
3번에서 의존하는 다음 Layer(Controller -> Service)의 인터페이스(1번)을 먼저 작성했다.


